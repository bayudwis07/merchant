<!doctype html>
<html lang="en" class="h-full antialiased">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>MMS Portal - Internal Banking</title>

    <!-- Script untuk Dark Mode Init -->
    <script>
      if (
        localStorage.getItem("color-theme") === "dark" ||
        (!("color-theme" in localStorage) &&
          window.matchMedia("(prefers-color-scheme: dark)").matches)
      ) {
        document.documentElement.classList.add("dark");
      } else {
        document.documentElement.classList.remove("dark");
      }
    </script>

    <script src="https://cdn.tailwindcss.com/3.4.17"></script>

    <!-- Library jsPDF -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.8.2/jspdf.plugin.autotable.min.js"></script>

    <!-- Library Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.2.0"></script>

    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap"
      rel="stylesheet"
    />

    <script>
      tailwind.config = {
        darkMode: "class",
        theme: {
          extend: {
            colors: {
              corporate: {
                50: "#f0f4f8",
                100: "#d9e2ec",
                500: "#243b53",
                600: "#102a43",
                700: "#0a1c2e",
              },
              brand: {
                500: "#0ea5e9",
                600: "#0284c7",
              },
            },
            fontFamily: { inter: ["Inter", "sans-serif"] },
            boxShadow: {
              soft: "0 4px 6px -1px rgba(0, 0, 0, 0.05), 0 2px 4px -1px rgba(0, 0, 0, 0.03)",
            },
          },
        },
      };
    </script>

    <link rel="stylesheet" href="css/style.css" />
  </head>

  <body
    class="h-full bg-slate-50 dark:bg-slate-900 font-inter text-slate-800 dark:text-slate-200 overflow-hidden"
  >
    <!-- TOAST NOTIFICATION CONTAINER               -->

    <div
      id="toastContainer"
      class="fixed top-6 right-6 z-[60] flex flex-col gap-3"
    ></div>

    <!-- HALAMAN LOGIN                              -->

    <div
      id="loginContainer"
      class="min-h-screen flex items-center justify-center bg-slate-100 dark:bg-slate-900 transition-theme px-4"
    >
      <div
        class="bg-white dark:bg-slate-800 p-8 rounded-xl shadow-lg w-full max-w-md border border-slate-200 dark:border-slate-700 animate-fade-in"
      >
        <div class="text-center mb-8">
          <div
            class="w-12 h-12 bg-corporate-600 dark:bg-slate-950 rounded-lg flex items-center justify-center mx-auto mb-4 border border-corporate-500 dark:border-slate-700 shadow-sm"
          >
            <svg
              class="w-7 h-7 text-brand-500"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"
              ></path>
            </svg>
          </div>
          <h2
            class="text-2xl font-bold text-slate-800 dark:text-white tracking-tight"
          >
            MMS Portal
          </h2>
          <p class="text-sm text-slate-500 dark:text-slate-400 mt-1">
            Silakan login untuk mengakses sistem
          </p>
        </div>
        <form id="loginForm" onsubmit="handleLogin(event)" class="space-y-5">
          <div>
            <label
              class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1.5"
              >Email</label
            >
            <input
              type="email"
              id="loginEmail"
              required
              class="w-full px-4 py-2.5 bg-slate-50 dark:bg-slate-900 border border-slate-300 dark:border-slate-600 rounded-lg outline-none focus:ring-2 focus:ring-brand-500 transition-theme text-slate-800 dark:text-white placeholder-slate-400 text-sm"
            />
          </div>
          <div>
            <label
              class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1.5"
              >Password</label
            >
            <input
              type="password"
              id="loginPassword"
              required
              class="w-full px-4 py-2.5 bg-slate-50 dark:bg-slate-900 border border-slate-300 dark:border-slate-600 rounded-lg outline-none focus:ring-2 focus:ring-brand-500 transition-theme text-slate-800 dark:text-white placeholder-slate-400 text-sm"
            />
          </div>
          <div
            id="loginError"
            class="hidden text-red-600 dark:text-red-400 text-xs font-semibold text-center bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800/50 p-3 rounded-lg"
          ></div>
          <button
            type="submit"
            id="loginBtn"
            class="w-full py-2.5 mt-2 bg-corporate-600 hover:bg-corporate-500 text-white rounded-lg font-medium transition-colors flex justify-center items-center shadow-md"
          >
            <span>Masuk ke Dashboard</span>
            <span
              id="loginLoader"
              class="loader ml-2 hidden"
              style="width: 14px; height: 14px; border-top-color: white"
            ></span>
          </button>
        </form>
      </div>
    </div>

    <!-- HALAMAN APLIKASI (APP CONTAINER)           -->

    <div id="appContainer" class="hidden h-screen w-full flex relative">
      <!-- SIDEBAR BACKDROP (Mobile) -->
      <div
        id="sidebarBackdrop"
        class="fixed inset-0 bg-slate-900/50 z-40 hidden lg:hidden"
        onclick="toggleSidebar()"
      ></div>

      <!-- SIDEBAR -->
      <aside
        id="sidebar"
        class="w-64 bg-corporate-600 dark:bg-slate-950 text-white flex-shrink-0 flex flex-col transition-transform duration-300 border-r border-corporate-700 dark:border-slate-800 shadow-xl z-50 fixed lg:static inset-y-0 left-0 transform -translate-x-full lg:translate-x-0"
      >
        <div
          class="p-5 border-b border-corporate-500 dark:border-slate-800 flex items-center justify-between"
        >
          <div class="flex items-center gap-3">
            <div
              class="w-8 h-8 bg-white/10 rounded-lg flex items-center justify-center border border-white/20"
            >
              <svg
                class="w-5 h-5 text-brand-500"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"
                ></path>
              </svg>
            </div>
            <div>
              <h1 class="text-lg font-bold tracking-tight">MMS System</h1>
              <p
                class="text-[10px] text-slate-300 font-medium tracking-widest uppercase"
              >
                Portal Internal
              </p>
            </div>
          </div>
          <!-- Close Sidebar Button (Mobile) -->
          <button
            onclick="toggleSidebar()"
            class="lg:hidden p-1 text-slate-300 hover:text-white rounded-md hover:bg-white/10"
          >
            <svg
              class="w-6 h-6"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M6 18L18 6M6 6l12 12"
              ></path>
            </svg>
          </button>
        </div>

        <div class="p-5">
          <p
            class="text-[11px] text-slate-400 font-semibold tracking-wider uppercase mb-3"
          >
            Menu Utama
          </p>
          <nav class="space-y-1.5">
            <button
              onclick="switchView('dashboard')"
              id="navDashboard"
              class="w-full flex items-center gap-3 px-3 py-2.5 rounded-lg bg-white/10 text-white font-medium transition-colors text-sm text-left"
            >
              <svg
                class="w-4 h-4"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M11 3.055A9.001 9.001 0 1020.945 13H11V3.055z"
                ></path>
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M20.488 9H15V3.512A9.025 9.025 0 0120.488 9z"
                ></path>
              </svg>
              Dashboard Rekap
            </button>
            <button
              onclick="switchView('data')"
              id="navData"
              class="w-full flex items-center gap-3 px-3 py-2.5 rounded-lg hover:bg-white/5 text-slate-300 hover:text-white transition-colors text-sm text-left hidden"
            >
              <svg
                class="w-4 h-4"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M4 7v10c0 2.21 3.582 4 8 4s8-1.79 8-4V7M4 7c0 2.21 3.582 4 8 4s8-1.79 8-4M4 7c0-2.21 3.582-4 8-4s8 1.79 8 4m0 5c0 2.21-3.582 4-8 4s-8-1.79-8-4"
                ></path>
              </svg>
              Master Data
            </button>
          </nav>
        </div>

        <div
          class="mt-auto p-5 border-t border-corporate-500 dark:border-slate-800 bg-corporate-700/50 dark:bg-slate-900/50"
        >
          <div class="flex items-center gap-3 mb-4">
            <div
              class="w-8 h-8 rounded-full bg-brand-500 flex items-center justify-center text-white font-bold text-xs"
              id="userInitial"
            >
              A
            </div>
            <div class="overflow-hidden">
              <p
                class="text-sm font-semibold text-white truncate"
                id="userGreetingNama"
              >
                Nama User
              </p>
              <p
                class="text-[10px] text-brand-400 capitalize"
                id="userGreetingRole"
              >
                Role
              </p>
            </div>
          </div>
          <!-- Trigger Modal Logout instead of calling handleLogout directly -->
          <button
            onclick="promptLogout()"
            class="w-full flex items-center justify-center gap-2 py-2 bg-red-500/10 text-red-400 hover:bg-red-500 hover:text-white border border-red-500/30 rounded-lg text-xs font-semibold transition-colors"
          >
            <svg
              class="w-3.5 h-3.5"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"
              ></path>
            </svg>
            Logout
          </button>
        </div>
      </aside>

      <!-- MAIN CONTENT AREA -->
      <div
        class="flex-1 flex flex-col h-screen overflow-hidden bg-slate-50 dark:bg-slate-900 w-full"
      >
        <!-- Header Top Bar -->
        <header
          class="bg-white dark:bg-slate-950 shadow-sm transition-theme border-b border-slate-200 dark:border-slate-800 z-20 shrink-0"
        >
          <div
            class="px-4 sm:px-6 lg:px-8 py-4 flex flex-col sm:flex-row sm:items-center justify-between gap-4"
          >
            <div class="flex items-center gap-3">
              <!-- Sidebar Toggle Button (Hamburger) -->
              <button
                onclick="toggleSidebar()"
                class="p-2 -ml-2 rounded-md hover:bg-slate-100 dark:hover:bg-slate-800 text-slate-500 dark:text-slate-400 focus:outline-none focus:ring-2 focus:ring-brand-500 transition-colors"
              >
                <svg
                  class="w-6 h-6"
                  fill="none"
                  stroke="currentColor"
                  viewBox="0 0 24 24"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M4 6h16M4 12h16M4 18h16"
                  ></path>
                </svg>
              </button>

              <!-- Logo Tampil Saat Navigasi (Sidebar) di-hide di layar kecil -->
              <div
                class="lg:hidden flex items-center gap-2 cursor-pointer hover:opacity-80 transition-opacity mr-2"
                onclick="toggleSidebar()"
                title="Buka Sidebar"
              >
                <div
                  class="w-8 h-8 bg-corporate-600 dark:bg-slate-900 rounded-lg flex items-center justify-center border border-corporate-500 dark:border-slate-700 shadow-sm"
                >
                  <svg
                    class="w-5 h-5 text-brand-500"
                    fill="none"
                    stroke="currentColor"
                    viewBox="0 0 24 24"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="2"
                      d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"
                    ></path>
                  </svg>
                </div>
              </div>

              <div>
                <h2
                  id="pageTitle"
                  class="text-lg font-bold text-slate-800 dark:text-white"
                >
                  Dashboard Rekapitulasi
                </h2>
                <p
                  class="text-xs text-slate-500 dark:text-slate-400 mt-0.5 hidden sm:block"
                >
                  Ringkasan performa dan produktivitas merchant.
                </p>
              </div>
            </div>

            <div class="flex flex-wrap items-center gap-3">
              <!-- Dark Mode -->
              <button
                id="themeToggleBtn"
                class="p-1.5 rounded-md bg-slate-100 dark:bg-slate-800 text-slate-500 dark:text-slate-400 hover:bg-slate-200 dark:hover:bg-slate-700 transition-colors"
                title="Toggle Dark Mode"
              >
                <svg
                  id="themeToggleDarkIcon"
                  class="hidden w-4 h-4"
                  fill="currentColor"
                  viewBox="0 0 20 20"
                >
                  <path
                    d="M17.293 13.293A8 8 0 016.707 2.707a8.001 8.001 0 1010.586 10.586z"
                  ></path>
                </svg>
                <svg
                  id="themeToggleLightIcon"
                  class="hidden w-4 h-4"
                  fill="currentColor"
                  viewBox="0 0 20 20"
                >
                  <path
                    d="M10 2a1 1 0 011 1v1a1 1 0 11-2 0V3a1 1 0 011-1zm4 8a4 4 0 11-8 0 4 4 0 018 0zm-.464 4.95l.707.707a1 1 0 001.414-1.414l-.707-.707a1 1 0 00-1.414 1.414zm2.12-10.607a1 1 0 010 1.414l-.706.707a1 1 0 11-1.414-1.414l.707-.707a1 1 0 011.414 0zM17 11a1 1 0 100-2h-1a1 1 0 100 2h1zm-7 4a1 1 0 011 1v1a1 1 0 11-2 0v-1a1 1 0 011-1zM5.05 6.464A1 1 0 106.465 5.05l-.708-.707a1 1 0 00-1.414 1.414l.707.707zm1.414 8.486l-.707.707a1 1 0 01-1.414-1.414l.707-.707a1 1 0 011.414 1.414zM4 11a1 1 0 100-2H3a1 1 0 000 2h1z"
                    fill-rule="evenodd"
                    clip-rule="evenodd"
                  ></path>
                </svg>
              </button>

              <div
                class="h-5 w-px bg-slate-200 dark:bg-slate-700 hidden sm:block"
              ></div>

              <!-- Visitor -->
              <div
                class="flex items-center gap-1.5 bg-slate-50 dark:bg-slate-800/50 border border-slate-200 dark:border-slate-700 rounded-md px-2.5 py-1"
              >
                <span class="text-[9px] text-slate-500 uppercase font-semibold"
                  >Visitors</span
                >
                <span
                  id="visitorCount"
                  class="text-xs font-bold text-slate-800 dark:text-white"
                  >--</span
                >
              </div>

              <!-- Last Update -->
              <div
                class="flex items-center gap-1.5 bg-slate-50 dark:bg-slate-800/50 border border-slate-200 dark:border-slate-700 rounded-md px-2.5 py-1"
              >
                <span class="text-[9px] text-slate-500 uppercase font-semibold"
                  >Updated</span
                >
                <span
                  id="dataTanggal"
                  class="text-xs font-bold text-slate-800 dark:text-white"
                  >Memuat...</span
                >
              </div>

              <!-- Status -->
              <div
                class="flex items-center gap-1.5 bg-emerald-50 dark:bg-emerald-500/10 border border-emerald-200 dark:border-emerald-500/20 rounded-md px-2.5 py-1"
              >
                <span
                  class="w-1.5 h-1.5 bg-emerald-500 rounded-full pulse-badge"
                  id="statusIndicator"
                ></span>
                <span
                  class="text-[9px] font-bold text-emerald-600 dark:text-emerald-400 uppercase"
                  id="statusText"
                  >LIVE</span
                >
              </div>
            </div>
          </div>
        </header>

        <!-- Scrollable Main Content -->
        <main class="flex-1 overflow-auto custom-scrollbar p-4 sm:p-6 lg:p-8">
          <!-- VIEW 1: DASHBOARD REKAP                    -->

          <div id="viewDashboard" class="space-y-6 animate-fade-in">
            <!-- Charts Section -->
            <section class="grid grid-cols-1 lg:grid-cols-3 gap-6">
              <!-- Chart 1: Delta SV per Cabang -->
              <div
                class="bg-white dark:bg-slate-800 rounded-xl shadow-soft border border-slate-200 dark:border-slate-700 p-5 lg:col-span-2 transition-theme"
              >
                <div class="flex justify-between items-start mb-6">
                  <div>
                    <h2
                      class="text-base font-bold text-slate-800 dark:text-white"
                    >
                      Sales Volume MoM
                    </h2>
                    <p class="text-xs text-slate-500 dark:text-slate-400 mt-1">
                      Dalam Juta Rupiah (Sesuai filter)
                    </p>
                  </div>
                  <button
                    onclick="
                      downloadChart('branchChart', 'Sales_Volume_MOM.png')
                    "
                    class="p-1.5 text-slate-500 hover:text-brand-600 dark:bg-slate-700/50 hover:bg-slate-100 dark:hover:bg-slate-700 rounded-md transition-colors"
                    title="Download PNG"
                  >
                    <svg
                      class="w-4 h-4"
                      fill="none"
                      stroke="currentColor"
                      viewBox="0 0 24 24"
                    >
                      <path
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        stroke-width="2"
                        d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"
                      ></path>
                    </svg>
                  </button>
                </div>
                <div class="relative min-h-[300px] w-full">
                  <canvas id="branchChart"></canvas>
                </div>
              </div>

              <!-- Chart 2: Donut Produktivitas Total -->
              <div
                class="bg-white dark:bg-slate-800 rounded-xl shadow-soft border border-slate-200 dark:border-slate-700 p-5 transition-theme flex flex-col lg:col-span-1"
              >
                <div class="flex justify-between items-start mb-4">
                  <div>
                    <h2
                      class="text-base font-bold text-slate-800 dark:text-white"
                    >
                      Status Produktivitas
                    </h2>
                    <p class="text-xs text-slate-500 dark:text-slate-400 mt-1">
                      Produktif vs Non-Produktif
                    </p>
                  </div>
                </div>
                <div
                  class="relative flex-1 min-h-[220px] w-full flex justify-center items-center"
                >
                  <canvas id="overallProductivityChart"></canvas>
                </div>
              </div>

              <!-- Chart 3: Produktivitas per Kanca -->
              <div
                class="bg-white dark:bg-slate-800 rounded-xl shadow-soft border border-slate-200 dark:border-slate-700 p-5 lg:col-span-3 transition-theme"
              >
                <div class="flex justify-between items-start mb-6">
                  <div>
                    <h2
                      class="text-base font-bold text-slate-800 dark:text-white"
                    >
                      Persentase Produktivitas Merchant
                    </h2>
                    <p class="text-xs text-slate-500 dark:text-slate-400 mt-1">
                      % Merchant Produktif
                    </p>
                  </div>
                </div>
                <div class="relative min-h-[300px] w-full flex justify-center">
                  <canvas id="productivityChart"></canvas>
                </div>
              </div>
            </section>
          </div>

          <!-- VIEW 2: MASTER DATA (Table View)           -->

          <div id="viewData" class="hidden space-y-6 animate-fade-in">
            <!-- Search & Filter Section -->
            <section
              class="bg-white dark:bg-slate-800 rounded-xl shadow-soft border border-slate-200 dark:border-slate-700 p-5 transition-theme"
            >
              <div class="flex flex-col xl:flex-row gap-4">
                <div class="flex-1 flex flex-col sm:flex-row gap-4">
                  <div class="w-full sm:w-56 relative shrink-0">
                    <select
                      id="searchCategory"
                      onchange="searchMerchant()"
                      class="w-full px-4 py-2.5 bg-slate-50 dark:bg-slate-900 border border-slate-300 dark:border-slate-600 rounded-lg focus:ring-2 focus:ring-brand-500/50 outline-none text-slate-700 dark:text-slate-200 text-sm font-medium transition-theme"
                    >
                      <option value="all">Semua Kategori</option>
                      <option value="namaKanca">Nama Kanca</option>
                      <option value="uker">Nama Uker</option>
                      <option value="tid">TID</option>
                      <option value="mid">MID</option>
                      <option value="nama">Nama Merchant</option>
                      <option value="pemrakarsa">Nama RMFT</option>
                    </select>
                  </div>
                  <div class="flex-1 relative">
                    <div
                      class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none"
                    >
                      <svg
                        class="w-4 h-4 text-slate-400"
                        fill="none"
                        stroke="currentColor"
                        viewBox="0 0 24 24"
                      >
                        <path
                          stroke-linecap="round"
                          stroke-linejoin="round"
                          stroke-width="2"
                          d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"
                        />
                      </svg>
                    </div>
                    <input
                      type="text"
                      id="searchInput"
                      onkeyup="searchMerchant()"
                      placeholder="Masukkan kata kunci pencarian..."
                      class="w-full pl-10 pr-4 py-2.5 bg-slate-50 dark:bg-slate-900 border border-slate-300 dark:border-slate-600 rounded-lg focus:ring-2 focus:ring-brand-500/50 outline-none transition-theme text-slate-700 dark:text-slate-200 text-sm"
                    />
                  </div>
                </div>

                <div
                  class="w-full xl:w-auto flex shadow-sm rounded-lg border border-slate-300 dark:border-slate-600 transition-theme bg-slate-50 dark:bg-slate-900 shrink-0"
                >
                  <select
                    id="svFilterType"
                    onchange="searchMerchant()"
                    class="px-3 py-2.5 bg-transparent outline-none text-slate-700 dark:text-slate-200 text-sm font-medium border-r border-slate-300 dark:border-slate-600"
                  >
                    <option value="all">Filter SV</option>
                    <option value=">=">SV ≥ (Min)</option>
                    <option value="<=">SV ≤ (Max)</option>
                  </select>
                  <input
                    type="number"
                    id="svFilterValue"
                    onkeyup="searchMerchant()"
                    placeholder="Nominal"
                    class="w-full sm:w-40 px-3 py-2.5 bg-transparent outline-none text-slate-700 dark:text-slate-200 text-sm"
                  />
                </div>

                <div class="flex items-center gap-2 w-full xl:w-auto shrink-0">
                  <button
                    onclick="clearSearch()"
                    class="flex-1 xl:flex-none px-4 py-2.5 bg-white dark:bg-slate-800 border border-slate-300 dark:border-slate-600 text-slate-700 dark:text-slate-200 rounded-lg font-medium hover:bg-slate-50 dark:hover:bg-slate-700 transition-colors text-sm shadow-sm"
                  >
                    Clear
                  </button>
                  <button
                    onclick="handleRefresh()"
                    class="flex-1 xl:flex-none px-4 py-2.5 bg-corporate-600 hover:bg-corporate-500 text-white border border-corporate-600 rounded-lg font-medium transition-colors flex items-center justify-center gap-2 text-sm shadow-sm"
                  >
                    Refresh
                  </button>
                </div>
              </div>
            </section>

            <!-- Top 25 Penurunan Section -->
            <section
              class="bg-white dark:bg-slate-800 rounded-xl shadow-soft border border-slate-200 dark:border-slate-700 overflow-hidden transition-theme"
            >
              <div
                class="px-5 py-4 border-b border-red-200 dark:border-red-900/30 bg-red-50 dark:bg-red-900/10 flex flex-col sm:flex-row justify-between gap-4"
              >
                <div class="flex items-center gap-3">
                  <div class="w-2 h-8 bg-red-500 rounded-full"></div>
                  <div>
                    <h2
                      class="text-base font-bold text-red-700 dark:text-red-400"
                    >
                      At-Risk Merchants (Top 25 Penurunan Sales Volume)
                    </h2>
                  </div>
                </div>
                <div class="flex items-center gap-2">
                  <button
                    onclick="downloadTop25CSV()"
                    class="px-3 py-1.5 bg-emerald-600 text-white rounded-md text-xs font-medium hover:bg-emerald-700"
                  >
                    CSV
                  </button>
                  <button
                    onclick="downloadTop25PDF()"
                    class="px-3 py-1.5 bg-red-600 text-white rounded-md text-xs font-medium hover:bg-red-700"
                  >
                    PDF
                  </button>
                </div>
              </div>
              <div class="custom-scrollbar overflow-auto max-h-[350px]">
                <table class="w-full text-left border-collapse">
                  <thead
                    class="sticky-header transition-theme text-slate-600 dark:text-slate-400 text-xs uppercase tracking-wider font-semibold"
                  >
                    <tr>
                      <th
                        class="px-5 py-3 text-center border-b border-slate-200 dark:border-slate-700"
                      >
                        No
                      </th>
                      <th
                        class="px-5 py-3 cursor-pointer border-b border-slate-200 dark:border-slate-700"
                        onclick="requestSort('top25', 'nama')"
                        data-table="top25"
                      >
                        Merchant
                        <span
                          class="sort-icon text-[10px] ml-1 opacity-60"
                          id="icon-top25-nama"
                        ></span>
                      </th>
                      <th
                        class="px-5 py-3 cursor-pointer border-b border-slate-200 dark:border-slate-700"
                        onclick="requestSort('top25', 'namaKanca')"
                        data-table="top25"
                      >
                        Lokasi
                        <span
                          class="sort-icon text-[10px] ml-1 opacity-60"
                          id="icon-top25-namaKanca"
                        ></span>
                      </th>
                      <th
                        class="px-5 py-3 border-b border-slate-200 dark:border-slate-700"
                      >
                        Terminal Info
                      </th>
                      <th
                        class="px-5 py-3 border-b border-slate-200 dark:border-slate-700"
                      >
                        RMFT
                      </th>
                      <th
                        class="px-5 py-3 text-right border-b border-slate-200 dark:border-slate-700"
                        onclick="requestSort('top25', 'deltaSv')"
                        data-table="top25"
                      >
                        Δ MOM
                        <span
                          class="sort-icon text-[10px] ml-1 opacity-60"
                          id="icon-top25-deltaSv"
                        ></span>
                      </th>
                    </tr>
                  </thead>
                  <tbody
                    id="top25Body"
                    class="divide-y divide-slate-100 dark:divide-slate-700/50"
                  ></tbody>
                </table>
              </div>
            </section>

            <!-- Master Data Section -->
            <section
              class="bg-white dark:bg-slate-800 rounded-xl shadow-soft border border-slate-200 dark:border-slate-700 overflow-hidden transition-theme"
            >
              <div
                class="px-5 py-4 border-b border-slate-200 dark:border-slate-700 flex flex-col sm:flex-row justify-between gap-4"
              >
                <div>
                  <h2
                    class="text-base font-bold text-slate-800 dark:text-white"
                  >
                    Master Data Merchant
                  </h2>
                </div>
                <div class="flex items-center gap-2">
                  <span
                    id="resultCount"
                    class="bg-slate-100 dark:bg-slate-700 text-slate-600 dark:text-slate-300 px-2.5 py-1 rounded-md text-xs font-semibold border border-slate-200 dark:border-slate-600"
                    >0 records</span
                  >
                  <button
                    id="btnSelectAllToggle"
                    onclick="toggleSelectAll()"
                    class="px-3 py-1.5 bg-brand-50 dark:bg-brand-900/20 text-brand-700 dark:text-brand-400 border border-brand-200 dark:border-brand-800/50 rounded-md text-xs font-medium"
                  >
                    Select All
                  </button>
                  <button
                    onclick="downloadMerchantDataCSV()"
                    class="px-3 py-1.5 bg-emerald-600 text-white rounded-md text-xs font-medium hover:bg-emerald-700"
                  >
                    Export CSV
                  </button>
                </div>
              </div>
              <div class="custom-scrollbar overflow-auto max-h-[450px]">
                <table
                  id="resultTable"
                  class="w-full text-left border-collapse"
                >
                  <thead
                    class="sticky-header transition-theme text-slate-600 dark:text-slate-400 text-xs uppercase tracking-wider font-semibold"
                  >
                    <tr>
                      <th
                        class="px-5 py-3 text-center border-b border-slate-200 dark:border-slate-700"
                      >
                        No
                      </th>
                      <th
                        class="px-5 py-3 cursor-pointer border-b border-slate-200 dark:border-slate-700"
                        onclick="requestSort('result', 'nama')"
                        data-table="result"
                      >
                        Merchant
                        <span
                          class="sort-icon text-[10px] ml-1 opacity-60"
                          id="icon-result-nama"
                        ></span>
                      </th>
                      <th
                        class="px-5 py-3 cursor-pointer border-b border-slate-200 dark:border-slate-700"
                        onclick="requestSort('result', 'namaKanca')"
                        data-table="result"
                      >
                        Lokasi
                        <span
                          class="sort-icon text-[10px] ml-1 opacity-60"
                          id="icon-result-namaKanca"
                        ></span>
                      </th>
                      <th
                        class="px-5 py-3 border-b border-slate-200 dark:border-slate-700"
                      >
                        Terminal Info
                      </th>
                      <th
                        class="px-5 py-3 border-b border-slate-200 dark:border-slate-700"
                      >
                        RMFT
                      </th>
                      <th
                        class="px-5 py-3 text-right border-b border-slate-200 dark:border-slate-700"
                      >
                        Trx Update
                      </th>
                      <th
                        class="px-5 py-3 text-right border-b border-slate-200 dark:border-slate-700"
                      >
                        SV Update
                      </th>
                      <th
                        class="px-5 py-3 text-right cursor-pointer border-b border-slate-200 dark:border-slate-700"
                        onclick="requestSort('result', 'deltaSv')"
                        data-table="result"
                      >
                        MoM Δ
                        <span
                          class="sort-icon text-[10px] ml-1 opacity-60"
                          id="icon-result-deltaSv"
                        ></span>
                      </th>
                      <th
                        class="px-5 py-3 text-center border-b border-slate-200 dark:border-slate-700"
                      >
                        Action
                      </th>
                    </tr>
                  </thead>
                  <tbody
                    id="resultBody"
                    class="divide-y divide-slate-100 dark:divide-slate-700/50"
                  ></tbody>
                </table>
              </div>
              <!-- Pagination Master -->
              <div
                id="paginationControlsResult"
                class="hidden px-5 py-3 border-t border-slate-200 dark:border-slate-700 bg-slate-50 dark:bg-slate-900/50 flex items-center justify-between gap-4"
              >
                <div class="flex items-center gap-2">
                  <select
                    id="itemsPerPageResult"
                    onchange="changeItemsPerPage('Result')"
                    class="border border-slate-300 dark:border-slate-600 rounded px-2 py-1 text-xs outline-none bg-white dark:bg-slate-800 text-slate-700 dark:text-slate-200"
                  >
                    <option value="10" selected>10</option>
                    <option value="50">50</option>
                    <option value="100">100</option>
                    <option value="all">All</option>
                  </select>
                </div>
                <div class="flex items-center gap-2">
                  <span
                    class="text-xs text-slate-500 mr-2"
                    id="paginationInfoResult"
                  ></span>
                  <button
                    onclick="prevPage('Result')"
                    id="btnPrevResult"
                    class="px-2.5 py-1 rounded border border-slate-300 dark:border-slate-600 text-xs font-medium text-slate-700 dark:text-slate-300"
                  >
                    Prev
                  </button>
                  <button
                    onclick="nextPage('Result')"
                    id="btnNextResult"
                    class="px-2.5 py-1 rounded border border-slate-300 dark:border-slate-600 text-xs font-medium text-slate-700 dark:text-slate-300"
                  >
                    Next
                  </button>
                </div>
              </div>
              <div id="emptyState" class="hidden py-16 text-center">
                <p
                  class="text-slate-500 dark:text-slate-400 font-semibold"
                  id="emptyStateText"
                >
                  Tidak ada data
                </p>
              </div>
            </section>

            <!-- Selected Data Table Section -->
            <section
              class="bg-white dark:bg-slate-800 rounded-xl shadow-soft border border-slate-200 dark:border-slate-700 overflow-hidden transition-theme"
            >
              <div
                class="px-5 py-4 border-b border-emerald-200 dark:border-emerald-900/30 bg-emerald-50 dark:bg-emerald-900/10 flex flex-col sm:flex-row justify-between gap-4"
              >
                <div class="flex items-center gap-3">
                  <div class="w-2 h-8 bg-emerald-500 rounded-full"></div>
                  <div>
                    <h2
                      class="text-base font-bold text-emerald-800 dark:text-emerald-400"
                    >
                      Monitoring List Terpilih
                    </h2>
                  </div>
                </div>
                <div class="flex items-center gap-2">
                  <span
                    id="selectedCount"
                    class="bg-white/50 dark:bg-slate-900/50 text-emerald-700 dark:text-emerald-400 px-2.5 py-1 rounded-md text-xs font-bold border border-emerald-200"
                    >0 selected</span
                  >
                  <button
                    onclick="downloadSelectedCSV()"
                    class="px-3 py-1.5 bg-emerald-600 text-white rounded-md text-xs font-medium hover:bg-emerald-700"
                  >
                    CSV
                  </button>
                  <button
                    onclick="downloadSelectedPDF()"
                    class="px-3 py-1.5 bg-red-600 text-white rounded-md text-xs font-medium hover:bg-red-700"
                  >
                    PDF
                  </button>
                  <button
                    onclick="clearSelected()"
                    class="px-3 py-1.5 bg-slate-500 text-white rounded-md text-xs font-medium hover:bg-slate-600"
                  >
                    Clear All
                  </button>
                </div>
              </div>
              <div class="custom-scrollbar overflow-auto max-h-[350px]">
                <table
                  id="selectedTable"
                  class="w-full text-left border-collapse"
                >
                  <thead
                    class="sticky-header transition-theme text-slate-600 dark:text-slate-400 text-xs uppercase tracking-wider font-semibold"
                  >
                    <tr>
                      <th
                        class="px-5 py-3 text-center border-b border-slate-200 dark:border-slate-700"
                      >
                        No
                      </th>
                      <th
                        class="px-5 py-3 border-b border-slate-200 dark:border-slate-700"
                      >
                        Merchant
                      </th>
                      <th
                        class="px-5 py-3 border-b border-slate-200 dark:border-slate-700"
                      >
                        Lokasi
                      </th>
                      <th
                        class="px-5 py-3 border-b border-slate-200 dark:border-slate-700"
                      >
                        Terminal Info
                      </th>
                      <th
                        class="px-5 py-3 border-b border-slate-200 dark:border-slate-700"
                      >
                        RMFT
                      </th>
                      <th
                        class="px-5 py-3 text-right border-b border-slate-200 dark:border-slate-700"
                      >
                        Trx Update
                      </th>
                      <th
                        class="px-5 py-3 text-right border-b border-slate-200 dark:border-slate-700"
                      >
                        SV Update
                      </th>
                      <th
                        class="px-5 py-3 text-right border-b border-slate-200 dark:border-slate-700"
                      >
                        MoM Δ
                      </th>
                      <th
                        class="px-5 py-3 text-center border-b border-slate-200 dark:border-slate-700"
                      >
                        Action
                      </th>
                    </tr>
                  </thead>
                  <tbody
                    id="selectedBody"
                    class="divide-y divide-slate-100 dark:divide-slate-700/50"
                  ></tbody>
                </table>
              </div>
              <!-- Pagination Selected -->
              <div
                id="paginationControlsSelected"
                class="hidden px-5 py-3 border-t border-slate-200 dark:border-slate-700 bg-slate-50 dark:bg-slate-900/50 flex items-center justify-between gap-4"
              >
                <div class="flex items-center gap-2">
                  <select
                    id="itemsPerPageSelected"
                    onchange="changeItemsPerPage('Selected')"
                    class="border border-slate-300 dark:border-slate-600 rounded px-2 py-1 text-xs outline-none bg-white dark:bg-slate-800 text-slate-700 dark:text-slate-200"
                  >
                    <option value="10" selected>10</option>
                    <option value="50">50</option>
                    <option value="all">All</option>
                  </select>
                </div>
                <div class="flex items-center gap-2">
                  <span
                    class="text-xs text-slate-500 mr-2"
                    id="paginationInfoSelected"
                  ></span>
                  <button
                    onclick="prevPage('Selected')"
                    id="btnPrevSelected"
                    class="px-2.5 py-1 rounded border border-slate-300 dark:border-slate-600 text-xs font-medium text-slate-700 dark:text-slate-300"
                  >
                    Prev
                  </button>
                  <button
                    onclick="nextPage('Selected')"
                    id="btnNextSelected"
                    class="px-2.5 py-1 rounded border border-slate-300 dark:border-slate-600 text-xs font-medium text-slate-700 dark:text-slate-300"
                  >
                    Next
                  </button>
                </div>
              </div>
              <div id="selectedEmptyState" class="py-12 text-center">
                <p
                  class="text-slate-500 dark:text-slate-400 font-medium text-sm"
                >
                  Belum ada merchant yang dipilih.
                </p>
              </div>
            </section>

            <!-- Summary Cards (Moved to bottom of Master Data View) -->
            <section class="grid grid-cols-1 sm:grid-cols-2 gap-6">
              <!-- Summary Trx -->
              <div
                class="bg-white dark:bg-slate-800 rounded-xl shadow-soft border border-slate-200 dark:border-slate-700 p-6 flex items-center justify-between transition-theme"
              >
                <div>
                  <p
                    class="text-xs font-bold text-slate-500 dark:text-slate-400 uppercase tracking-wider"
                  >
                    Total Δ Trx (Selected)
                  </p>
                  <p
                    id="totalTrx"
                    class="text-2xl font-bold text-slate-800 dark:text-white mt-1 transition-colors duration-300"
                  >
                    0
                  </p>
                </div>
                <div
                  class="w-12 h-12 bg-blue-50 dark:bg-blue-900/20 rounded-lg flex items-center justify-center border border-blue-100 dark:border-blue-800/50"
                >
                  <svg
                    class="w-6 h-6 text-brand-500"
                    fill="none"
                    stroke="currentColor"
                    viewBox="0 0 24 24"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="2"
                      d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"
                    />
                  </svg>
                </div>
              </div>
              <!-- Summary SV -->
              <div
                class="bg-white dark:bg-slate-800 rounded-xl shadow-soft border border-slate-200 dark:border-slate-700 p-6 flex items-center justify-between transition-theme"
              >
                <div>
                  <p
                    class="text-xs font-bold text-slate-500 dark:text-slate-400 uppercase tracking-wider"
                  >
                    Total Δ SV (Selected)
                  </p>
                  <p
                    id="totalSv"
                    class="text-2xl font-bold text-slate-800 dark:text-white mt-1 transition-colors duration-300"
                  >
                    Rp 0
                  </p>
                </div>
                <div
                  class="w-12 h-12 bg-emerald-50 dark:bg-emerald-900/20 rounded-lg flex items-center justify-center border border-emerald-100 dark:border-emerald-800/50"
                >
                  <svg
                    class="w-6 h-6 text-emerald-500"
                    fill="none"
                    stroke="currentColor"
                    viewBox="0 0 24 24"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="2"
                      d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"
                    />
                  </svg>
                </div>
              </div>
            </section>
          </div>
        </main>
      </div>
    </div>

    <!-- LOGOUT CONFIRMATION MODAL                  -->

    <div
      id="logoutModal"
      class="fixed inset-0 z-[70] hidden flex items-center justify-center px-4"
    >
      <div
        class="absolute inset-0 bg-slate-900/60 backdrop-blur-sm transition-opacity"
        onclick="closeLogoutModal()"
      ></div>
      <div
        class="bg-white dark:bg-slate-800 rounded-xl shadow-xl border border-slate-200 dark:border-slate-700 w-full max-w-sm p-6 relative z-10 transform scale-95 opacity-0 transition-all duration-200"
        id="logoutModalContent"
      >
        <div
          class="w-12 h-12 rounded-full bg-red-100 dark:bg-red-900/30 flex items-center justify-center mb-4 mx-auto border border-red-200 dark:border-red-800"
        >
          <svg
            class="w-6 h-6 text-red-600 dark:text-red-400"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"
            ></path>
          </svg>
        </div>
        <h3
          class="text-lg font-bold text-center text-slate-800 dark:text-white mb-2"
        >
          Konfirmasi Keluar
        </h3>
        <p class="text-sm text-center text-slate-500 dark:text-slate-400 mb-6">
          Apakah Anda yakin ingin keluar dari sistem?
        </p>
        <div class="flex gap-3">
          <button
            onclick="closeLogoutModal()"
            class="flex-1 py-2.5 rounded-lg border border-slate-300 dark:border-slate-600 text-slate-700 dark:text-slate-300 font-medium hover:bg-slate-50 dark:hover:bg-slate-700 transition-colors"
          >
            Batal
          </button>
          <button
            onclick="confirmLogout()"
            class="flex-1 py-2.5 rounded-lg bg-red-600 hover:bg-red-700 text-white font-medium transition-colors shadow-sm"
          >
            Ya, Keluar
          </button>
        </div>
      </div>
    </div>

    <script src="js/script.js"></script>
  </body>
</html>
